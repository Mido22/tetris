{"version":3,"sources":["../client/js/app.js"],"names":[],"mappings":";;AAAA,IAAI,SAAS,GAAG,OAAO,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,cAAc,CAAC,CAAC,CAAC;;AAE9D,SAAS,CAAC,UAAU,CAAC,UAAU,EAAE,CAAC,QAAQ,EAAE,UAAU,EAAE,WAAW,EAC/D,UAAC,MAAM,EAAE,QAAQ,EAAE,SAAS,EAAK;AACnC,QAAM,CAAC,CAAC,GAAG,MAAM;;AAAC,AAGlB,WAAS,UAAU,CAAC,KAAK,EAAC;AACxB,QAAG,CAAC,MAAM,CAAC,MAAM,IAAI,CAAC,MAAM,CAAC,MAAM,CAAC,MAAM,EAAG,OAAO;;AAEpD,WAAO,CAAC,GAAG,CAAC,KAAK,CAAC,GAAG,EAAE,KAAK,CAAC,KAAK,CAAC,CAAC;AACpC,YAAO,KAAK,CAAC,KAAK;AAChB,WAAK,EAAE,CAAC;AACR,WAAK,EAAE;AAAE,iBAAS,EAAE,CAAC,AAAC,MAAM;AAAA,AAC5B,WAAK,EAAE,CAAC;AACR,WAAK,EAAE;AAAE,mBAAW,EAAE,CAAC,AAAC,MAAM;AAAA,AAC9B,WAAK,EAAE,CAAC;AACR,WAAK,EAAE;AAAE,mBAAW,EAAE,CAAC,AAAC,MAAM;AAAA,AAC9B,WAAK,EAAE,CAAC;AACR,WAAK,EAAE;AAAE,oBAAY,EAAE,CAAC,AAAC,MAAM;AAAA,AAC/B,WAAK,EAAE,CAAC;AACR,WAAK,EAAE;AAAE,oBAAY,EAAE,CAAC,AAAC,MAAM;AAAA,AAC/B,WAAK,EAAE;AAAE,cAAM,CAAC,SAAS,GAAG,CAAC,MAAM,CAAC,SAAS,CAAC,AAAC,MAAM;AAAA,KACtD;AACD,YAAQ,EAAE,CAAC;GACZ;;AAED,WAAS,SAAS,GAAE;AAClB,QAAG,MAAM,CAAC,MAAM,CAAC,MAAM,IAAI,SAAS,EAClC,MAAM,CAAC,MAAM,CAAC,WAAW,EAAE,CAAC,KAE5B,MAAM,CAAC,WAAW,EAAE,CAAC;AACvB,QAAG,MAAM,CAAC,WAAW,GAAC,EAAE,EAAE,MAAM,CAAC,WAAW,GAAG,EAAE,CAAC;GACnD;;AAED,WAAS,WAAW,GAAE;AACpB,QAAG,MAAM,CAAC,MAAM,CAAC,MAAM,IAAI,SAAS,EAClC,MAAM,CAAC,MAAM,CAAC,aAAa,EAAE,CAAC,KAE9B,MAAM,CAAC,WAAW,EAAE,CAAC;AACvB,QAAG,MAAM,CAAC,WAAW,GAAC,EAAE,EAAE,MAAM,CAAC,WAAW,GAAG,EAAE,CAAC;GACnD;;AAED,WAAS,YAAY,GAAE;AACrB,QAAG,MAAM,CAAC,MAAM,CAAC,MAAM,IAAI,SAAS,EAClC,MAAM,CAAC,MAAM,CAAC,cAAc,EAAE,CAAC,KAE/B,MAAM,CAAC,UAAU,EAAE,CAAC;AACtB,QAAG,MAAM,CAAC,UAAU,GAAC,EAAE,EAAE,MAAM,CAAC,UAAU,GAAG,EAAE,CAAC;GACjD;;AAED,WAAS,WAAW,GAAE;AACpB,QAAG,MAAM,CAAC,MAAM,CAAC,MAAM,IAAI,SAAS,EAClC,MAAM,CAAC,MAAM,CAAC,aAAa,EAAE,CAAC,KAE9B,MAAM,CAAC,UAAU,EAAE,CAAC;AACtB,QAAG,MAAM,CAAC,UAAU,GAAC,EAAE,EAAE,MAAM,CAAC,UAAU,GAAG,EAAE,CAAC;GACjD;;AAED,WAAS,YAAY,GAAE;AACrB,QAAG,CAAC,MAAM,CAAC,MAAM,IAAI,MAAM,CAAC,MAAM,CAAC,MAAM,IAAE,SAAS,EAAE,OAAO;AAC7D,UAAM,CAAC,MAAM,CAAC,YAAY,CAAC,MAAM,CAAC,WAAW,EAAE,MAAM,CAAC,UAAU,CAAC,CAAC;GACnE;;AAED,WAAS,IAAI,GAAE;AACb,QAAI,MAAM,GAAG,IAAI,MAAM,EAAE,CAAC;AAC1B,UAAM,CAAC,WAAW,CAAC,WAAW,EAAE,QAAQ,CAAC,CAAC;AAC1C,UAAM,CAAC,WAAW,CAAC,WAAW,EAAE,YAAI;AAClC,gBAAU,CAAC,QAAQ,EAAE,GAAG,CAAC;AAAC,KAC3B,CAAC,CAAC;AACH,UAAM,CAAC,MAAM,GAAG,MAAM,CAAC;AACvB,UAAM,CAAC,WAAW,GAAG,EAAE,CAAC;AACxB,UAAM,CAAC,UAAU,GAAG,EAAE,CAAC;AACvB,aAAS,CAAC,EAAE,CAAC,SAAS,EAAE,UAAU,CAAC,CAAC;AACpC,UAAM,CAAC,SAAS,GAAG,IAAI,CAAC;GACzB;;AAED,WAAS,QAAQ,GAAE;AACjB,QAAI,KAAK,GAAG,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC;AACjC,QAAG,KAAK,KAAK,QAAQ,IAAI,KAAK,KAAK,SAAS,EAAE;AAC5C,YAAM,CAAC,MAAM,GAAG,MAAM,CAAC,MAAM,CAAC,aAAa,EAAE,CAAC;AAC9C,UAAG;AACD,cAAM,CAAC,eAAe,GAAG,KAAK,CAAC;AAC/B,cAAM,CAAC,MAAM,EAAE,CAAC;OACjB,CAAA,OAAM,CAAC,EAAC;AAAC,eAAO,CAAC,GAAG,CAAC,gBAAgB,EAAE,CAAC,CAAC,CAAC;OAAC;KAC7C,MAAI;AACH,mBAAa,EAAE,CAAC;KACjB;GACF;;AAED,WAAS,aAAa,GAAE;AACtB,QAAG,MAAM,CAAC,eAAe,EAAG,OAAO;AACnC,UAAM,CAAC,eAAe,GAAG,IAAI,CAAC;AAC9B,cAAU,CAAC,YAAM;AACf,YAAM,CAAC,eAAe,GAAG,KAAK,CAAC;AAC/B,cAAQ,EAAE,CAAC;KACZ,EAAE,GAAG,CAAC,CAAC;GACT;;AAED,MAAI,EAAE,CAAC;CAER,CAAC,CAAC,CAAC","file":"app.js","sourcesContent":["var theModule = angular.module('theModule', ['ui.bootstrap']);\r\n\r\ntheModule.controller('mainCtrl', ['$scope', '$timeout', '$document'\r\n  , ($scope, $timeout, $document) => {\r\n  window.s = $scope; // for Debug, remove THIS.\r\n\r\n  \r\n  function onKeyPress(event){\r\n    if(!$scope.tetris || !$scope.tetris.status)  return;\r\n\r\n    console.log(event.key, event.which);\r\n    switch(event.which){\r\n      case 87: \r\n      case 38: onArrowUp(); break;\r\n      case 83: \r\n      case 40: onArrowDown(); break;\r\n      case 65: \r\n      case 37: onArrowLeft(); break;\r\n      case 68: \r\n      case 39: onArrowRight(); break;\r\n      case 69:\r\n      case 13: startNewGame(); break;\r\n      case 72: $scope.showHints = !$scope.showHints; break;\r\n    }\r\n    updateUI();\r\n  }\r\n\r\n  function onArrowUp(){\r\n    if($scope.tetris.status == 'started')\r\n      $scope.tetris.rotatePiece();\r\n    else\r\n      $scope.boardHeight++;\r\n    if($scope.boardHeight>21) $scope.boardHeight = 21;\r\n  }\r\n\r\n  function onArrowDown(){\r\n    if($scope.tetris.status == 'started')\r\n      $scope.tetris.movePieceDown();\r\n    else\r\n      $scope.boardHeight--;\r\n    if($scope.boardHeight<11) $scope.boardHeight = 11;\r\n  }\r\n\r\n  function onArrowRight(){\r\n    if($scope.tetris.status == 'started')\r\n      $scope.tetris.movePieceRight();\r\n    else\r\n      $scope.boardWidth++;\r\n    if($scope.boardWidth>21) $scope.boardWidth = 21;\r\n  }\r\n\r\n  function onArrowLeft(){\r\n    if($scope.tetris.status == 'started')\r\n      $scope.tetris.movePieceLeft();\r\n    else\r\n      $scope.boardWidth--;\r\n    if($scope.boardWidth<11) $scope.boardWidth = 11;\r\n  }\r\n\r\n  function startNewGame(){\r\n    if(!$scope.tetris || $scope.tetris.status=='started') return;\r\n    $scope.tetris.startNewGame($scope.boardHeight, $scope.boardWidth);\r\n  }\r\n\r\n  function init(){\r\n    let tetris = new Tetris();\r\n    tetris.addListener('update UI', updateUI);\r\n    tetris.addListener('game over', ()=>{\r\n      setTimeout(updateUI, 100); // keeping a delay not to clash with the other update UI;\r\n    });\r\n    $scope.tetris = tetris;   \r\n    $scope.boardHeight = 16;\r\n    $scope.boardWidth = 16;\r\n    $document.on('keydown', onKeyPress);\r\n    $scope.showHints = true;\r\n  }  \r\n\r\n  function updateUI(){ \r\n    var phase = $scope.$root.$$phase;\r\n    if(phase !== '$apply' && phase !== '$digest') {\r\n      $scope.coords = $scope.tetris.getViewCoords();\r\n      try{\r\n        $scope.uiUpdateWaiting = false;\r\n        $scope.$apply();\r\n      }catch(e){console.log('error caught: ', e);}\r\n    }else{\r\n      delayUIUpdate();\r\n    }  \r\n  }\r\n  \r\n  function delayUIUpdate(){\r\n    if($scope.uiUpdateWaiting)  return;    \r\n    $scope.uiUpdateWaiting = true;\r\n    setTimeout(() => {\r\n      $scope.uiUpdateWaiting = false;\r\n      updateUI();\r\n    }, 100);\r\n  } \r\n\r\n  init();\r\n\r\n}]);"]}